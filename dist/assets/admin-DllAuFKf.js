import{d as O,a as fe,s as we,A as ne,o as Ee,i as xe,m as ve,p as ue,b as Z,G as Ie,r as Be}from"./db-config-JzEx42YR.js";import{collection as Le,query as i,orderBy as q,where as x,limit as f,startAfter as M,getDocs as D,serverTimestamp as B,updateDoc as j,doc as b,addDoc as ee,getDoc as te,deleteDoc as G,writeBatch as de,getCountFromServer as ke,onSnapshot as ge}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{b as $e,f as le,d as Se}from"./tools-Cv2G4J4g.js";function c(n){return Le(O,"artifacts",fe,"public","data",n)}function u(n,s="success"){const e=document.getElementById("toast-container");if(!e)return;const t=document.createElement("div"),o=s==="success"?"bg-emerald-600 border-emerald-400":"bg-rose-600 border-rose-400",a=s==="success"?"fa-check-circle":"fa-exclamation-triangle";t.className=`${o} text-white border-l-4 px-6 py-4 rounded shadow-2xl flex items-center gap-4 toast-enter min-w-[320px] pointer-events-auto backdrop-blur-md mb-3`,t.innerHTML=`<i class="fas ${a} text-2xl"></i><div><span class="font-bold block">${s==="success"?"‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à":"‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"}</span><span class="text-sm">${n}</span></div>`,e.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateX(100%)",setTimeout(()=>t.remove(),400)},4e3)}function h(n,s="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•..."){const e=document.getElementById("loading-overlay"),t=document.getElementById("loading-text");t&&(t.textContent=s),e&&(n?(e.classList.remove("hidden"),e.classList.add("flex")):(e.classList.add("hidden"),e.classList.remove("flex")))}function R(n,s,e){const t=document.getElementById("confirm-modal");document.getElementById("confirm-title").textContent=n,document.getElementById("confirm-message").textContent=s;const o=document.getElementById("btn-confirm-ok"),a=document.getElementById("btn-confirm-cancel"),r=o.cloneNode(!0),d=a.cloneNode(!0);o.parentNode.replaceChild(r,o),a.parentNode.replaceChild(d,a),t.classList.remove("hidden"),t.classList.add("flex"),r.addEventListener("click",()=>{t.classList.add("hidden"),t.classList.remove("flex"),e()}),d.addEventListener("click",()=>{t.classList.add("hidden"),t.classList.remove("flex")})}let z=[];const $=20;let E=1,U=[null],H={field:"updatedAt",dir:"desc"};function Ce(){var n,s,e,t,o;(n=document.getElementById("btn-search-show"))==null||n.addEventListener("click",()=>S(!0)),(s=document.getElementById("btn-reset-show"))==null||s.addEventListener("click",()=>{document.getElementById("search-show").value="",S(!1)}),(e=document.getElementById("show-form"))==null||e.addEventListener("submit",Te),(t=document.getElementById("next-page-show"))==null||t.addEventListener("click",()=>S(!1,"next")),(o=document.getElementById("prev-page-show"))==null||o.addEventListener("click",()=>S(!1,"prev")),window.openShowModal=he,window.sortShows=a=>{H.field===a?H.dir=H.dir==="asc"?"desc":"asc":(H.field=a,H.dir="desc"),S(!1,"reset")},S()}async function he(n=null){const s=document.getElementById("show-modal"),e=document.getElementById("show-form");if(e.reset(),e.dataset.id=n||"",document.querySelectorAll(".show-tag-option").forEach(t=>t.checked=!1),n){let t=z.find(o=>o.id===n);if(!t){h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");try{const o=await te(b(c("shows"),n));if(o.exists())t={id:o.id,...o.data()};else{u("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞ (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)","error"),h(!1);return}}catch(o){console.error("Error fetching show details:",o),u("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","error"),h(!1);return}h(!1)}t&&(document.getElementById("show-title").value=t.title,document.getElementById("show-desc").value=t.description||"",document.getElementById("show-thumbnail").value=t.thumbnailUrl,document.getElementById("show-view-count").value=t.viewCount||0,document.getElementById("show-completed").checked=t.isCompleted||!1,t.tags&&Array.isArray(t.tags)&&t.tags.forEach(o=>{const a=document.querySelector(`.show-tag-option[value="${o}"]`);a&&(a.checked=!0)}))}s.classList.remove("hidden"),s.classList.add("flex")}async function Te(n){n.preventDefault(),h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...");const s=n.target.dataset.id,e=document.getElementById("show-title").value.trim(),t=Array.from(document.querySelectorAll(".show-tag-option:checked")).map(a=>a.value);t.length===0&&t.push("‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞");const o={title:e,description:document.getElementById("show-desc").value,thumbnailUrl:document.getElementById("show-thumbnail").value,viewCount:parseInt(document.getElementById("show-view-count").value)||0,isCompleted:document.getElementById("show-completed").checked,tags:t,keywords:$e(e),updatedAt:B()};try{s?await j(b(c("shows"),s),o):(o.createdAt=B(),o.latestEpisodeNumber=0,o.episodeCount=0,await ee(c("shows"),o)),u("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"),document.getElementById("show-modal").classList.add("hidden"),document.getElementById("show-modal").classList.remove("flex"),S(!1,s?"current":"reset")}catch(a){console.error(a),u(a.message,"error")}finally{h(!1)}}async function S(n=!1,s="reset"){h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");const e=document.getElementById("show-table-body"),t=document.getElementById("next-page-show"),o=document.getElementById("prev-page-show");t&&(t.disabled=!0),o&&(o.disabled=!0),(s==="reset"||n)&&(e.innerHTML='<tr><td colspan="5" class="text-center py-10 text-gray-400 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>');try{let a;const r=c("shows"),d=i(r,q(H.field,H.dir)),p=document.getElementById("search-show").value.trim().toLowerCase();if(n&&p)a=i(r,x("keywords","array-contains",p),f($)),E=1,U=[null];else if(s==="reset")a=i(d,f($)),E=1,U=[null];else if(s==="next"){const l=U[E];l?(a=i(d,M(l),f($)),E++):a=i(d,f($))}else if(s==="prev"){if(E>1){E--;const l=U[E-1];l?a=i(d,M(l),f($)):a=i(d,f($))}}else if(s==="current"){const l=U[E-1];l?a=i(d,M(l),f($)):a=i(d,f($))}const m=await D(a);if(m.empty&&s!=="reset"&&E>1){E--,S(!1,"current");return}z=m.docs.map(l=>({id:l.id,...l.data(),doc:l})),z.length===0?e.innerHTML='<tr><td colspan="5" class="text-center py-10 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>':(Ae(z),m.docs.length===$&&(U[E]=m.docs[m.docs.length-1],t&&(t.disabled=!1)));const g=document.getElementById("page-info-show");g&&(g.textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${E}`),o&&(o.disabled=E===1)}catch(a){console.error(a),e.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${a.message}</td></tr>`}finally{h(!1)}}function Ae(n){const s=document.getElementById("show-table-body");s.innerHTML="",n.forEach(e=>{const t=document.createElement("tr");t.className="border-b border-gray-700 hover:bg-gray-800 transition-colors",t.innerHTML=`
            <td class="px-6 py-4 flex items-center gap-3">
                <img src="${e.thumbnailUrl}" class="w-10 h-10 object-cover rounded bg-gray-700" onerror="this.src='https://placehold.co/40x40?text=?'">
                <div class="flex flex-col">
                    <span class="truncate max-w-xs text-white cursor-help" title="${e.title}">${e.title}</span>
                    <span class="text-xs text-gray-500">${(e.tags||[]).slice(0,3).join(", ")}</span>
                </div>
            </td>
            <td class="px-6 py-4 text-gray-300 text-center font-medium">${e.latestEpisodeNumber||0}</td>
            <td class="px-6 py-4 text-gray-300 text-center font-medium">${e.viewCount||0}</td>
            <td class="px-6 py-4 text-gray-400 text-center text-sm font-mono">${le(e.updatedAt)}</td>
            <td class="px-6 py-4 text-right space-x-2 whitespace-nowrap">
                <button class="bg-indigo-600 hover:bg-indigo-500 text-white px-2 py-1 rounded text-xs btn-manage transition-colors" data-id="${e.id}" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ô"><i class="fas fa-list-ol"></i> ‡∏ï‡∏≠‡∏ô</button>
                <button class="bg-gray-700 hover:bg-gray-600 p-2 rounded text-gray-300 btn-edit transition-colors" data-id="${e.id}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"><i class="fas fa-edit"></i></button>
                <button class="bg-red-900/30 hover:bg-red-900/50 p-2 rounded text-red-400 btn-del transition-colors" data-id="${e.id}" title="‡∏•‡∏ö"><i class="fas fa-trash"></i></button>
            </td>
        `,s.appendChild(t)}),s.querySelectorAll(".btn-manage").forEach(e=>e.onclick=()=>{window.switchTab("episodes");const t=document.getElementById("filter-episode-show");if(t){t.value=e.dataset.id;const o=document.getElementById("btn-load-episodes");o&&o.click()}}),s.querySelectorAll(".btn-edit").forEach(e=>e.onclick=()=>he(e.dataset.id)),s.querySelectorAll(".btn-del").forEach(e=>e.onclick=()=>Me(e.dataset.id))}async function K(n,s,e){let o=!0,a=0;for(;o;){const r=i(c(n),x(s,"==",e),f(400)),d=await D(r);if(d.empty){o=!1;break}const p=de(O);d.docs.forEach(m=>{p.delete(m.ref)}),await p.commit(),a+=d.size,h(!0,`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö ${n}... ‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${a} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`)}}async function Me(n){R("‡∏•‡∏ö‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£",async()=>{h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö...");try{await K("episodes","showId",n),await K("banners","showId",n),await K("reports","showId",n),await K("comments","showId",n),await G(b(c("shows"),n)),u("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß"),S(!1,"current"),window.fetchDashboardStats&&window.fetchDashboardStats()}catch(s){console.error(s),u("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+s.message,"error")}finally{h(!1)}})}let X=[],N=null,C=[],A=!1;const P=50;let L=1,W=[null],J="desc";function Ne(){var s,e,t,o,a,r,d;De(),(s=document.getElementById("btn-load-episodes"))==null||s.addEventListener("click",()=>k("reset")),(e=document.getElementById("episode-form"))==null||e.addEventListener("submit",Pe),(t=document.getElementById("btn-submit-bulk"))==null||t.addEventListener("click",Fe),(o=document.getElementById("next-page-ep"))==null||o.addEventListener("click",()=>k("next")),(a=document.getElementById("prev-page-ep"))==null||a.addEventListener("click",()=>k("prev"));const n=document.getElementById("btn-sort-episodes");n&&n.addEventListener("click",()=>{J=J==="desc"?"asc":"desc";const p=n.querySelector("i");J==="asc"?(p.className="fas fa-sort-numeric-down text-emerald-400",n.title="‡πÄ‡∏Å‡πà‡∏≤ -> ‡πÉ‡∏´‡∏°‡πà"):(p.className="fas fa-sort-numeric-up-alt",n.title="‡πÉ‡∏´‡∏°‡πà -> ‡πÄ‡∏Å‡πà‡∏≤"),k("reset")}),be(),He(),(r=document.getElementById("episode-show-select"))==null||r.addEventListener("change",p=>{const m=p.target.value;if(!document.getElementById("episode-form").dataset.id&&m){const l=C.find(y=>y.id===m);l&&(document.getElementById("episode-number").value=(l.latestEpisodeNumber||0)+1)}}),(d=document.getElementById("bulk-episode-show-select"))==null||d.addEventListener("change",p=>{const m=p.target.value;if(m){const g=C.find(l=>l.id===m);if(g){const l=(g.latestEpisodeNumber||0)+1,y=document.getElementById("bulk-start-ep");y&&(y.value=l)}}}),window.openEpisodeModal=Ue,window.openBulkEpisodeModal=_e,window.deleteEpisode=Oe}function De(){const n=document.getElementById("btn-sort-episodes");if(n&&!document.getElementById("search-ep-number")){const s=document.createElement("div");s.className="relative",s.innerHTML=`
            <input type="number" id="search-ep-number" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà..." 
                class="bg-gray-900 border border-gray-700 rounded-lg py-2.5 px-3 text-white text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 w-32"
            >
            <button id="btn-search-ep-number" class="absolute right-1 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-1.5">
                <i class="fas fa-search"></i>
            </button>
        `,n.parentNode.insertBefore(s,n);const e=s.querySelector("input"),t=s.querySelector("button"),o=()=>{const a=e.value.trim();a?k("search_number",a):k("reset")};t.addEventListener("click",o),e.addEventListener("keyup",a=>{a.key==="Enter"&&o(),a.key==="Backspace"&&e.value===""&&k("reset")})}}function He(){[{select:document.getElementById("episode-show-select"),id:"search-ep-show"},{select:document.getElementById("filter-episode-show"),id:"search-filter-show"},{select:document.getElementById("bulk-episode-show-select"),id:"search-bulk-show"}].forEach(({select:s,id:e})=>{if(!s||s.parentNode.querySelector("input"))return;const t=document.createElement("div");t.className="space-y-1 mb-2 searchable-wrapper";const o=document.createElement("input");o.type="text",o.id=e,o.placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á...",o.className="block w-full bg-gray-800 border border-gray-600 rounded-lg text-xs py-1.5 px-3 text-gray-300 mb-1 focus:ring-1 focus:ring-indigo-500",s.parentNode.insertBefore(t,s),t.appendChild(o),t.appendChild(s),o.addEventListener("input",Se(async a=>{const r=a.target.value.trim();r.length>0?await be(r):ie(C)},500))})}function ye(n){const s=document.getElementById(n);s&&(s.value="",ie(C))}async function be(n=""){try{let s;n?s=i(c("shows"),x("title",">=",n),x("title","<=",n+"Ô£ø"),f(20)):s=i(c("shows"),q("updatedAt","desc"),f(50));const t=(await D(s)).docs.map(o=>({id:o.id,title:o.data().title,latestEpisodeNumber:o.data().latestEpisodeNumber||0}));n||(C=t),ie(t)}catch(s){console.warn("Dropdown Error:",s)}}function ie(n){["filter-episode-show","episode-show-select","bulk-episode-show-select"].forEach(s=>{const e=document.getElementById(s);if(!e)return;const t=e.value;let o='<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞ --</option>';if(n.forEach(a=>{o+=`<option value="${a.id}">${a.title}</option>`}),e.innerHTML=o,t){if(!n.find(r=>r.id===t)){const r=C.find(d=>d.id===t);if(r){const d=document.createElement("option");d.value=r.id,d.textContent=r.title,d.selected=!0,e.appendChild(d)}}e.value=t}})}async function oe(n,s){if(!n)return;const e=document.getElementById(s);if(e)if(e.querySelector(`option[value="${n}"]`))e.value=n;else try{const t=await te(b(c("shows"),n));if(t.exists()){const o=document.createElement("option");o.value=t.id,o.textContent=t.data().title,e.appendChild(o),e.value=n,C.find(a=>a.id===n)||C.push({id:t.id,title:t.data().title,latestEpisodeNumber:t.data().latestEpisodeNumber||0})}}catch(t){console.error(t)}}async function ce(n){if(n)try{const s=c("episodes"),e=i(s,x("showId","==",n),q("number","desc"),f(1)),t=await D(e);let o=0;t.empty||(o=t.docs[0].data().number);const a=i(s,x("showId","==",n)),r=await ke(a);await j(b(c("shows"),n),{latestEpisodeNumber:o,episodeCount:r.data().count,latestEpisodeUpdateAt:B(),updatedAt:B()})}catch(s){console.error("Recalculate Error:",s)}}async function qe(n,s,e=null){const t=i(c("episodes"),x("showId","==",n),x("number","==",s)),o=await D(t);return!(o.empty||e&&o.docs.length===1&&o.docs[0].id===e)}async function k(n="reset",s=null){var g;const e=document.getElementById("filter-episode-show"),t=e.value;if(!t){u("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞‡∏Å‡πà‡∏≠‡∏ô","error");return}h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≠‡∏ô..."),N!==t&&n!=="reset"&&(n="reset"),N=t;const o=document.getElementById("episode-table-body"),a=document.getElementById("next-page-ep"),r=document.getElementById("prev-page-ep"),d=document.getElementById("page-info-ep"),p=document.getElementById("episode-pagination"),m=((g=e.options[e.selectedIndex])==null?void 0:g.text)||"Unknown";document.getElementById("episodes-header-title").textContent=`‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ô: ${m}`,document.getElementById("btn-back-to-shows").classList.remove("hidden");try{const l=c("episodes");let y;if(n==="search_number"&&s)y=i(l,x("showId","==",t),x("number","==",parseFloat(s))),p&&p.classList.add("hidden");else{const w=i(l,x("showId","==",t),q("number",J));if(n==="reset")y=i(w,f(P)),L=1,W=[null];else if(n==="next"){const _=W[L];y=i(w,f(P)),_&&(y=i(w,M(_),f(P))),L++}else if(n==="prev"){L=Math.max(1,L-1);const _=W[L-1];y=i(w,f(P)),_&&L>1&&(y=i(w,M(_),f(P)))}p&&p.classList.remove("hidden")}const v=await D(y);if(v.empty){let w="‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô";n==="search_number"&&(w=`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${s}`),o.innerHTML=`<tr><td colspan="4" class="text-center py-10 text-gray-500">${w}</td></tr>`,X=[],a&&(a.disabled=!0)}else X=v.docs.map(w=>({id:w.id,...w.data()})),Re(X),n!=="search_number"&&(v.docs.length===P?(W[L]=v.docs[v.docs.length-1],a&&(a.disabled=!1)):a&&(a.disabled=!0),d&&(d.textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${L}`),r&&(r.disabled=L===1))}catch(l){if(console.error(l),l.message.includes("index")){const y=l.message.match(/https:\/\/console\.firebase\.google\.com[^\s]*/);o.innerHTML=`
                <tr>
                    <td colspan="4" class="text-center py-6">
                        <div class="bg-yellow-900/30 border border-yellow-600/50 rounded-lg p-4 inline-block max-w-2xl">
                            <div class="flex flex-col items-center gap-2">
                                <i class="fas fa-exclamation-triangle text-2xl text-yellow-500 mb-1"></i>
                                <span class="font-bold text-yellow-100">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Index ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</span>
                                <span class="text-sm text-gray-400">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>
                                ${y?`<a href="${y[0]}" target="_blank" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded shadow-lg text-sm transition-all mt-2 flex items-center gap-2"><i class="fas fa-external-link-alt"></i> ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Index ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</a>`:""}
                            </div>
                        </div>
                    </td>
                </tr>`}else o.innerHTML=`<tr><td colspan="4" class="text-center py-4 text-red-400">Error: ${l.message}</td></tr>`}finally{h(!1)}}function Re(n){const s=document.getElementById("episode-table-body");s.innerHTML="",n.forEach(e=>{const t=document.createElement("tr");t.className="hover:bg-gray-700/50 transition-colors border-b border-gray-700/50",t.innerHTML=`
            <td class="px-6 py-4 text-sm font-medium text-white">‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${e.number}</td>
            <td class="px-6 py-4 text-sm text-gray-300">${e.title||"-"}</td>
            <td class="px-6 py-4 text-sm text-gray-400">${le(e.updatedAt)}</td>
            <td class="px-6 py-4 text-right text-sm font-medium space-x-2">
                <button class="text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 p-1.5 rounded-md transition-all" onclick="openEpisodeModal('${e.id}')"><i class="fas fa-edit"></i></button>
                <button class="text-red-400 hover:text-red-300 bg-red-900/20 hover:bg-red-900/40 p-1.5 rounded-md transition-all" onclick="deleteEpisode('${e.id}')"><i class="fas fa-trash"></i></button>
            </td>
        `,s.appendChild(t)})}async function Ue(n=null){const s=document.getElementById("episode-form");if(s.reset(),s.dataset.id=n||"",ye("search-ep-show"),n){const e=X.find(t=>t.id===n);e&&(await oe(e.showId,"episode-show-select"),document.getElementById("episode-show-select").value=e.showId,document.getElementById("episode-number").value=e.number,document.getElementById("episode-title").value=e.title||"",document.getElementById("episode-url").value=e.videoUrl||"")}else if(N){await oe(N,"episode-show-select");const e=document.getElementById("episode-show-select");e.value=N,e.dispatchEvent(new Event("change"))}document.getElementById("episode-modal").classList.remove("hidden"),document.getElementById("episode-modal").classList.add("flex")}async function Pe(n){if(n.preventDefault(),A)return;const s=n.target.dataset.id,e=document.getElementById("episode-show-select").value,t=parseFloat(document.getElementById("episode-number").value);if(!e){u("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞","error");return}A=!0,h(!0);try{if(await qe(e,t,s))throw new Error(`‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${t} ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß!`);const a={showId:e,number:t,title:document.getElementById("episode-title").value.trim(),videoUrl:document.getElementById("episode-url").value.trim(),updatedAt:B()};s?await j(b(c("episodes"),s),a):(a.createdAt=B(),await ee(c("episodes"),a)),await ce(e),u("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"),document.getElementById("episode-modal").classList.add("hidden"),document.getElementById("episode-modal").classList.remove("flex"),N===e&&k("current")}catch(o){u(o.message,"error")}finally{A=!1,h(!1)}}async function _e(){const n=N,s=document.getElementById("bulk-urls");if(s.value="",ye("search-bulk-show"),n){await oe(n,"bulk-episode-show-select");const e=document.getElementById("bulk-episode-show-select");e.value=n;const t=C.find(o=>o.id===n);t&&(document.getElementById("bulk-start-ep").value=(t.latestEpisodeNumber||0)+1)}document.getElementById("bulk-episode-modal").classList.remove("hidden"),document.getElementById("bulk-episode-modal").classList.add("flex")}async function Fe(){if(A)return;const n=document.getElementById("bulk-episode-show-select").value,s=document.getElementById("bulk-urls").value.trim().split(`
`).filter(t=>t.trim()!=="");let e=parseFloat(document.getElementById("bulk-start-ep").value);if(!n){u("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏∞","error");return}if(s.length===0){u("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","error");return}R("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô",`‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° ${s.length} ‡∏ï‡∏≠‡∏ô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ô ${e}?`,async()=>{A=!0,h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡∏ã‡πâ‡∏≥...");try{const t=i(c("episodes"),x("showId","==",n),x("number",">=",e)),o=await D(t),a=new Set(o.docs.map(g=>g.data().number));let r=[],d=0,p=e;if(s.forEach(g=>{a.has(p)?d++:r.push({showId:n,number:p,title:`‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà ${p}`,videoUrl:g.trim(),createdAt:B(),updatedAt:B()}),p++}),r.length===0){u(`‡∏ó‡∏∏‡∏Å‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (${d} ‡∏ï‡∏≠‡∏ô)`,"error"),h(!1),A=!1;return}if(d>0&&!confirm(`‚ö†Ô∏è ‡∏û‡∏ö‡∏ï‡∏≠‡∏ô‡∏ã‡πâ‡∏≥ ${d} ‡∏ï‡∏≠‡∏ô!
‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ${r.length} ‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà

‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)){h(!1),A=!1;return}h(!0,`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${r.length} ‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà...`);const m=400;for(let g=0;g<r.length;g+=m){const l=de(O);r.slice(g,g+m).forEach(v=>{const w=b(c("episodes"));l.set(w,v)}),await l.commit()}await ce(n),u(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${r.length} ‡∏ï‡∏≠‡∏ô (‡∏Ç‡πâ‡∏≤‡∏° ${d} ‡∏ï‡∏≠‡∏ô‡∏ã‡πâ‡∏≥)`),document.getElementById("bulk-episode-modal").classList.add("hidden"),document.getElementById("bulk-episode-modal").classList.remove("flex"),N===n&&k("current")}catch(t){console.error(t),u("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+t.message,"error")}finally{A=!1,h(!1)}})}async function Oe(n){R("‡∏•‡∏ö‡∏ï‡∏≠‡∏ô","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?",async()=>{h(!0,"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...");try{const s=b(c("episodes"),n),e=await te(s);if(e.exists()){const{showId:t}=e.data();await G(s),await ce(t),u("‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"),k("current")}}catch(s){u(s.message,"error")}finally{h(!1)}})}let Q=null,V=[],ae=null;function je(){const n=document.getElementById("banner-table-body"),s=document.getElementById("banner-form");if(typeof window.dragula<"u"&&n&&(Q?Q.containers=[n]:(Q=window.dragula([n]),Q.on("drop",async()=>{const e=de(O);Array.from(n.children).forEach((t,o)=>{e.update(b(c("banners"),t.dataset.id),{order:o+1})}),await e.commit(),u("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")}))),ge(i(c("banners"),q("order")),e=>{V=e.docs.map(t=>({id:t.id,...t.data()})),n.innerHTML="",V.forEach(t=>{const o=document.createElement("tr");o.className="border-b border-gray-700 hover:bg-gray-800 transition-colors cursor-move",o.dataset.id=t.id,o.innerHTML=`
                <td class="px-6 py-4"><img src="${t.imageUrl}" class="h-10 rounded object-cover bg-gray-700" onerror="this.src='https://placehold.co/100x40?text=No+Img'"></td>
                <td class="px-6 py-4 text-white">${t.title} ${t.isActive?'<span class="text-emerald-400 text-xs ml-1">(Active)</span>':""}</td>
                <td class="px-6 py-4 text-gray-300">${t.order}</td>
                <td class="px-6 py-4 text-right">
                    <button class="btn-edit text-gray-400 hover:text-white mr-2" data-id="${t.id}"><i class="fas fa-edit"></i></button>
                    <button class="btn-del text-red-400 hover:text-red-300 bg-red-900/20 hover:bg-red-900/40 p-2 rounded transition-colors" data-id="${t.id}"><i class="fas fa-trash"></i></button>
                </td>
            `,n.appendChild(o)}),n.querySelectorAll(".btn-edit").forEach(t=>{t.onclick=()=>me(t.dataset.id)}),n.querySelectorAll(".btn-del").forEach(t=>{t.onclick=()=>Ke(t.dataset.id)})}),s){const e=s.cloneNode(!0);s.parentNode.replaceChild(e,s),e.addEventListener("submit",Ge)}window.openBannerModal=me}async function Ge(n){n.preventDefault();const s={title:document.getElementById("banner-title").value,imageUrl:document.getElementById("banner-image-url").value,linkUrl:document.getElementById("banner-link-url").value,order:parseInt(document.getElementById("banner-order").value)||0,isActive:document.getElementById("banner-active").checked,updatedAt:B()};if(s.linkUrl&&s.linkUrl.includes("id="))try{const t=new URLSearchParams(s.linkUrl.split("?")[1]).get("id");t&&(s.showId=t)}catch{}try{ae?(await j(b(c("banners"),ae),s),u("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")):(s.createdAt=B(),await ee(c("banners"),s),u("‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")),document.getElementById("banner-modal").classList.add("hidden"),document.getElementById("banner-modal").classList.remove("flex")}catch(e){u(e.message,"error")}}function me(n=null){if(ae=n,document.getElementById("banner-form").reset(),n){const e=V.find(t=>t.id===n);e&&(document.getElementById("banner-title").value=e.title,document.getElementById("banner-image-url").value=e.imageUrl,document.getElementById("banner-link-url").value=e.linkUrl||"",document.getElementById("banner-order").value=e.order,document.getElementById("banner-active").checked=e.isActive)}else document.getElementById("banner-order").value=V.length+1;document.getElementById("banner-modal").classList.remove("hidden"),document.getElementById("banner-modal").classList.add("flex")}function Ke(n){R("‡∏•‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?",async()=>{await G(b(c("banners"),n)),u("‡∏•‡∏ö‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß")})}let re=null;function We(){var n;ge(i(c("tags"),q("name","asc")),s=>{const e=s.docs.map(t=>({id:t.id,...t.data()}));Qe(e),Ze(e)}),(n=document.getElementById("tag-form"))==null||n.addEventListener("submit",async s=>{s.preventDefault();try{const e={name:document.getElementById("tag-name").value.trim(),slug:document.getElementById("tag-slug").value.trim()};re?(await j(b(c("tags"),re),e),u("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")):(e.createdAt=B(),await ee(c("tags"),e),u("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")),document.getElementById("tag-modal").classList.add("hidden"),document.getElementById("tag-modal").classList.remove("flex")}catch(e){u(e.message,"error")}})}function Qe(n){const s=document.getElementById("tag-table-body");s&&(s.innerHTML="",n.forEach(e=>{const t=document.createElement("tr");t.className="border-b border-gray-700 hover:bg-gray-800 transition-colors",t.innerHTML=`
            <td class="px-6 py-4 text-white">${e.name}</td>
            <td class="px-6 py-4 text-gray-400 font-mono">${e.slug}</td>
            <td class="px-6 py-4 text-right space-x-2">
                <button class="btn-edit text-gray-400 hover:text-white" data-id="${e.id}" data-name="${e.name}" data-slug="${e.slug}"><i class="fas fa-edit"></i></button>
                <button class="btn-del text-red-400 hover:text-red-300" data-id="${e.id}"><i class="fas fa-trash"></i></button>
            </td>`,s.appendChild(t)}),s.querySelectorAll(".btn-edit").forEach(e=>{e.onclick=()=>ze(e.dataset.id,e.dataset.name,e.dataset.slug)}),s.querySelectorAll(".btn-del").forEach(e=>{e.onclick=()=>Xe(e.dataset.id)}))}function Ze(n){const s=document.getElementById("tags-checkbox-container");s&&(s.innerHTML="",n.forEach(e=>{const t=document.createElement("div");t.className="flex items-center space-x-2 p-2 hover:bg-gray-800 rounded",t.innerHTML=`
            <input type="checkbox" id="tag-${e.id}" value="${e.name}" class="show-tag-option form-checkbox h-4 w-4 text-indigo-500 bg-gray-900 border-gray-600 rounded">
            <label for="tag-${e.id}" class="text-sm text-gray-300 cursor-pointer select-none">${e.name}</label>
        `,s.appendChild(t)}))}function ze(n,s,e){re=n,document.getElementById("tag-name").value=s,document.getElementById("tag-slug").value=e,document.getElementById("tag-modal-title").innerText="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà",document.getElementById("tag-modal").classList.remove("hidden"),document.getElementById("tag-modal").classList.add("flex")}function Xe(n){R("‡∏•‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?",async()=>G(b(c("tags"),n)))}let pe=[];const T=20;let I=1,F=[null];function Je(){var n,s,e;(n=document.getElementById("next-page-report"))==null||n.addEventListener("click",()=>fetchReports("next")),(s=document.getElementById("prev-page-report"))==null||s.addEventListener("click",()=>fetchReports("prev")),(e=document.getElementById("btn-refresh-reports"))==null||e.addEventListener("click",()=>fetchReports("reset"))}window.fetchReports=async function(n="reset"){const s=document.getElementById("next-page-report"),e=document.getElementById("prev-page-report"),t=document.getElementById("report-table-body");s&&(s.disabled=!0),e&&(e.disabled=!0),t&&(t.innerHTML='<tr><td colspan="5" class="text-center py-10 text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>');try{const o=c("reports"),a=i(o,q("createdAt","desc"));let r;if(n==="reset")r=i(a,f(T)),I=1,F=[null];else if(n==="next"){const m=F[I];m?(r=i(a,M(m),f(T)),I++):r=i(a,f(T))}else if(n==="prev"){if(I>1){I--;const m=F[I-1];m?r=i(a,M(m),f(T)):r=i(a,f(T))}}else{const m=F[I-1];m?r=i(a,M(m),f(T)):r=i(a,f(T))}const d=await D(r);if(d.empty&&n!=="reset"&&I>1){I--,window.fetchReports("current");return}d.empty?t&&(t.innerHTML='<tr><td colspan="5" class="text-center py-10 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤</td></tr>'):(pe=await Promise.all(d.docs.map(async g=>{const l=g.data();let y="Unknown Show";if(l.showId)try{const v=await te(b(c("shows"),l.showId));v.exists()&&(y=v.data().title)}catch(v){console.warn("Fetch show title error",v)}return{id:g.id,...l,showTitle:y,doc:g}})),Ve(pe),d.docs.length===T?(F[I]=d.docs[d.docs.length-1],s&&(s.disabled=!1)):s&&(s.disabled=!0));const p=document.getElementById("page-info-report");p&&(p.textContent=`‡∏´‡∏ô‡πâ‡∏≤ ${I}`),e&&(e.disabled=I===1)}catch(o){console.error(o),t&&(t.innerHTML=`<tr><td colspan="5" class="text-center py-4 text-red-400">Error: ${o.message}</td></tr>`)}};function Ve(n){const s=document.getElementById("report-table-body");s&&(s.innerHTML="",n.forEach(e=>{const t=document.createElement("tr");t.className="hover:bg-gray-700/50 border-b border-gray-700/50",t.innerHTML=`
            <td class="px-6 py-4 text-sm text-white">${e.showTitle}</td>
            <td class="px-6 py-4 text-sm text-gray-300">Ep ID: ...${e.episodeId?e.episodeId.slice(-5):"-"}</td>
            <td class="px-6 py-4 text-sm text-rose-400 font-medium">${e.reason||"User Report"}</td>
            <td class="px-6 py-4 text-sm text-gray-400">${le(e.createdAt)}</td>
            <td class="px-6 py-4 text-right text-sm font-medium space-x-2">
                <button class="text-red-400 hover:text-red-300 bg-red-900/20 hover:bg-red-900/40 p-1.5 rounded-md transition-all btn-del-report" data-id="${e.id}"><i class="fas fa-trash"></i></button>
            </td>
        `,s.appendChild(t)}),s.querySelectorAll(".btn-del-report").forEach(e=>{e.addEventListener("click",()=>Ye(e.dataset.id))}))}function Ye(n){R("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?",async()=>{try{await G(b(c("reports"),n)),u("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"),window.fetchReports("current"),window.fetchDashboardStats&&window.fetchDashboardStats()}catch(s){u(s.message,"error")}})}we("silent");window.switchTab=function(n){["dashboard","shows","episodes","banners","reports","tags"].forEach(e=>{const t=document.getElementById(e+"-panel");t&&(e===n?t.classList.remove("hidden"):t.classList.add("hidden"))}),document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("bg-gray-800","text-white","shadow-md"),e.classList.add("text-gray-400")});const s=document.getElementById("tab-"+n);s&&(s.classList.add("bg-gray-800","text-white","shadow-md"),s.classList.remove("text-gray-400")),n==="dashboard"&&Y(),n==="reports"&&window.fetchReports&&window.fetchReports("reset")};async function Y(){try{const[n,s,e]=await Promise.all([ne(c("shows")),ne(c("episodes")),ne(c("reports"))]);document.getElementById("stat-total-shows").innerText=n.data().count,document.getElementById("stat-total-episodes").innerText=s.data().count,document.getElementById("stat-total-reports").innerText=e.data().count;const t=document.getElementById("report-badge");t&&(t.innerText=e.data().count,t.classList.toggle("hidden",e.data().count===0))}catch(n){console.error(n)}}window.fetchDashboardStats=Y;Ee(Z,async n=>{if(n)try{const s=xe(O,`artifacts/${fe}/users/${n.uid}`),e=await ve(s);if(e.exists()&&e.data().role==="admin"){console.log("Admin Logged In:",n.email),et(),Y(),Ce(),Ne(),je(),We(),Je(),setInterval(Y,6e4);const t=document.getElementById("btn-logout");if(t){const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),o.addEventListener("click",()=>{R("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?",async()=>{await ue(Z),window.location.reload()})})}}else u("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin","error"),await ue(Z),se()}catch(s){console.error("Admin check error:",s),u("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå","error"),se()}else se()});function se(){if(document.getElementById("admin-login-overlay"))return;const n=document.createElement("div");n.id="admin-login-overlay",n.className="fixed inset-0 bg-gray-900 z-[9999] flex flex-col items-center justify-center p-4",n.innerHTML=`
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700 max-w-sm w-full text-center">
            <h1 class="text-3xl font-bold text-white mb-2">Admin Login</h1>
            <p class="text-gray-400 mb-8">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</p>
            
            <button id="btn-admin-login" class="w-full flex items-center justify-center gap-3 bg-white hover:bg-gray-100 text-gray-900 font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-lg">
                <i class="fab fa-google text-xl text-red-600"></i>
                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
            </button>
            <p class="mt-6 text-xs text-gray-500">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
        </div>
    `,document.body.appendChild(n),document.getElementById("btn-admin-login").onclick=async()=>{try{const s=new Ie;await Be(Z,s)}catch(s){u("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: "+s.message,"error")}}}function et(){const n=document.getElementById("admin-login-overlay");n&&n.remove()}
