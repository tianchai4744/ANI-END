import{s as f,o as b,a as v,q as u,d as g,f as r,e as c,g as L,b as k,c as I,h as E,i as w}from"./db-config-CDOV0zmd.js";import{l as B}from"./navbar-BPKScrBx.js";import{c as S}from"./card-lo2QomBm.js";import{s as y}from"./search-Cjk7YTPU.js";import{o as $}from"./tools-BcGrSTdy.js";let i,m=[];async function q(){f("silent"),b(v,async t=>{const s=document.getElementById("loading-state"),e=document.getElementById("login-required-state"),d=document.getElementById("empty-state"),o=document.getElementById("bookmarks-grid");t?(i=t.uid,e.classList.add("hidden"),await H(),A()):(s.classList.add("hidden"),e.classList.remove("hidden"),d.classList.add("hidden"),o.innerHTML="",y())})}async function H(){try{const t=u(g(r,`artifacts/${c}/users/${i}/viewHistory`));m=(await L(t)).docs.map(e=>({id:e.id,...e.data()})),y(m)}catch(t){console.error("Search init error",t)}}function A(){const t=document.getElementById("bookmarks-grid"),s=document.getElementById("loading-state"),e=document.getElementById("empty-state"),d=u(g(r,`artifacts/${c}/users/${i}/bookmarks`),k("savedAt","desc"));I(d,o=>{if(s.classList.add("hidden"),t.innerHTML="",o.empty){e.classList.remove("hidden");return}e.classList.add("hidden");let l="";o.forEach(a=>{const n=a.data(),p=m.find(h=>h.showId===a.id);l+=`
                <div class="relative group">
                    ${S({id:a.id,...n},null,p)}
                    <button class="btn-remove-bookmark absolute top-2 right-2 z-20 bg-red-600 hover:bg-red-700 text-white p-1.5 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity transform hover:scale-110" data-id="${a.id}" title="ลบจากรายการโปรด">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            `}),t.innerHTML=l,$(t),document.querySelectorAll(".btn-remove-bookmark").forEach(a=>{a.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),confirm("ลบเรื่องนี้จากรายการโปรด?")&&await E(w(r,`artifacts/${c}/users/${i}/bookmarks`,a.dataset.id))})})})}document.addEventListener("DOMContentLoaded",async()=>{await B(".."),q();const t=document.getElementById("btn-login-page");t&&(t.onclick=()=>window.triggerLogin())});
