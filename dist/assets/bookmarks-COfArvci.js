import{s as f,o as b,b as L,q as u,f as g,d as r,a as c,g as v,c as k,e as I,h as E,i as w}from"./db-config-JzEx42YR.js";import{c as B}from"./card-DUAddn7M.js";import{s as y}from"./search-CnOzQKex.js";import{l as S}from"./navbar-DtgS--Xs.js";import"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import"./tools-Cv2G4J4g.js";let i,l=[];async function $(){f("silent"),b(L,async t=>{const s=document.getElementById("loading-state"),e=document.getElementById("login-required-state"),d=document.getElementById("empty-state"),o=document.getElementById("bookmarks-grid");t?(i=t.uid,e.classList.add("hidden"),await q(),H()):(s.classList.add("hidden"),e.classList.remove("hidden"),d.classList.add("hidden"),o.innerHTML="",y([]))})}async function q(){try{const t=u(g(r,`artifacts/${c}/users/${i}/viewHistory`));l=(await v(t)).docs.map(e=>({id:e.id,...e.data()})),y(l)}catch(t){console.error("Search init error",t)}}function H(){const t=document.getElementById("bookmarks-grid"),s=document.getElementById("loading-state"),e=document.getElementById("empty-state"),d=u(g(r,`artifacts/${c}/users/${i}/bookmarks`),k("savedAt","desc"));I(d,o=>{if(s.classList.add("hidden"),t.innerHTML="",o.empty){e.classList.remove("hidden");return}e.classList.add("hidden");let m="";o.forEach(a=>{const n=a.data(),p=l.find(h=>h.showId===a.id);m+=`
                        <div class="relative group">
                            ${B({id:a.id,...n},null,p)}
                            <button class="btn-remove-bookmark absolute top-2 right-2 z-20 bg-red-600 hover:bg-red-700 text-white p-1.5 rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity transform hover:scale-110" data-id="${a.id}" title="ลบจากรายการโปรด">
                                <i class="ri-delete-bin-line"></i>
                            </button>
                        </div>
                    `}),t.innerHTML=m,document.querySelectorAll(".btn-remove-bookmark").forEach(a=>{a.addEventListener("click",async n=>{n.preventDefault(),n.stopPropagation(),confirm("ลบเรื่องนี้จากรายการโปรด?")&&await E(w(r,`artifacts/${c}/users/${i}/bookmarks`,a.dataset.id))})})})}document.addEventListener("DOMContentLoaded",async()=>{await S(".."),$();const t=document.getElementById("btn-login-page");t&&(t.onclick=()=>window.triggerLogin())});
