import{q as c,l as i,b as h,w as B,d as u,e as f,f as m,j as C,g as $}from"./db-config-CDOV0zmd.js";import{l as H}from"./navbar-BPKScrBx.js";import{c as P}from"./card-lo2QomBm.js";import{o as R}from"./tools-BcGrSTdy.js";import{s as q,l as D,a as j}from"./search-Cjk7YTPU.js";const r=24;let o="latest",T="",w=null,l=[],M=0,d=!0,b=!1,a,s,S,L,g,y,E;async function F(){a=document.getElementById("anime-grid"),s=document.getElementById("load-more-btn"),S=document.getElementById("no-results"),L=document.getElementById("page-title"),g=document.getElementById("result-count"),y=document.getElementById("clear-search-btn"),E=document.getElementById("scroll-to-top"),s.addEventListener("click",G),E.onclick=()=>window.scrollTo({top:0,behavior:"smooth"}),window.addEventListener("scroll",()=>{E.classList.toggle("visible",window.scrollY>300)}),await H("../"),q();const e=new URLSearchParams(window.location.search),t=e.get("search"),n=e.get("tag");a.innerHTML="",s.classList.add("hidden"),_(),t?(o="search",await N(t)):n?(o="tag",T=decodeURIComponent(n),await Q(T)):(o="latest",await U())}async function N(e){L.innerHTML=`ผลการค้นหา: "<span class="text-green-400">${e}</span>"`,y.classList.remove("hidden"),g.textContent="กำลังค้นหาข้อมูล...";try{await D(),l=j(e),g.textContent=`พบทั้งหมด ${l.length} เรื่อง`,l.length===0?k():x()}catch(t){console.error("Search Error:",t),A()}}function x(){const e=M*r,t=e+r,n=l.slice(e,t);I(n),t>=l.length?(d=!1,s.classList.add("hidden")):(d=!0,M++,s.classList.remove("hidden"))}async function Q(e){L.innerText=`หมวดหมู่: ${e}`,y.classList.add("hidden"),await p(c(u(m,`artifacts/${f}/public/data/shows`),B("tags","array-contains",e),h("updatedAt","desc"),i(r)))}async function U(){L.innerText="อัปเดตล่าสุด",y.classList.add("hidden"),await p(c(u(m,`artifacts/${f}/public/data/shows`),h("updatedAt","desc"),i(r)))}async function p(e){if(!b){b=!0,s.disabled=!0,s.innerText="กำลังโหลด...";try{w&&(e=c(e,C(w)));const t=await $(e),n=t.docs.map(v=>({id:v.id,...v.data()}));n.length>0?(w=t.docs[t.docs.length-1],I(n),n.length<r?(d=!1,s.classList.add("hidden")):(d=!0,s.classList.remove("hidden")),(o==="tag"||o==="latest")&&(g.textContent=`แสดงรายการที่โหลดแล้ว ${a.children.length} เรื่อง`)):(d=!1,s.classList.add("hidden"),a.children.length===0&&k())}catch(t){console.error("Firebase Error:",t),A()}finally{b=!1,s.disabled=!1,s.innerText="โหลดเพิ่มเติม",a.querySelectorAll(".skeleton").forEach(n=>n.remove())}}}function I(e){a.querySelector(".skeleton")&&(a.innerHTML="");const t=e.map(n=>P(n)).join("");a.insertAdjacentHTML("beforeend",t),R(a)}function _(){let e="";for(let t=0;t<12;t++)e+='<div class="aspect-[2/3] rounded-xl skeleton"></div>';a.innerHTML=e}function k(){a.classList.add("hidden"),S.classList.remove("hidden"),s.classList.add("hidden"),a.querySelectorAll(".skeleton").forEach(t=>t.remove())}function A(){a.innerHTML='<p class="col-span-full text-center text-red-400 py-10">เกิดข้อผิดพลาดในการโหลดข้อมูล โปรดลองใหม่</p>'}function G(){if(o==="search")x();else if(o==="tag"){const e=c(u(m,`artifacts/${f}/public/data/shows`),B("tags","array-contains",T),h("updatedAt","desc"),i(r));p(e)}else{const e=c(u(m,`artifacts/${f}/public/data/shows`),h("updatedAt","desc"),i(r));p(e)}}document.addEventListener("DOMContentLoaded",F);
