import{d as nt}from"./tools-BcGrSTdy.js";import{g as it,d as ot,f as rt,e as ct}from"./db-config-CDOV0zmd.js";const at="ENTRIES",Y="KEYS",H="VALUES",_="";class V{constructor(t,e){const s=t._tree,n=Array.from(s.keys());this.set=t,this._type=e,this._path=n.length>0?[{node:s,keys:n}]:[]}next(){const t=this.dive();return this.backtrack(),t}dive(){if(this._path.length===0)return{done:!0,value:void 0};const{node:t,keys:e}=b(this._path);if(b(e)===_)return{done:!1,value:this.result()};const s=t.get(b(e));return this._path.push({node:s,keys:Array.from(s.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;const t=b(this._path).keys;t.pop(),!(t.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:t})=>b(t)).filter(t=>t!==_).join("")}value(){return b(this._path).node.get(_)}result(){switch(this._type){case H:return this.value();case Y:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}}const b=i=>i[i.length-1],dt=(i,t,e)=>{const s=new Map;if(t===void 0)return s;const n=t.length+1,o=n+e,r=new Uint8Array(o*n).fill(e+1);for(let c=0;c<n;++c)r[c]=c;for(let c=1;c<o;++c)r[c*n]=c;return K(i,t,e,s,r,1,n,""),s},K=(i,t,e,s,n,o,r,c)=>{const a=o*r;t:for(const d of i.keys())if(d===_){const l=n[a-1];l<=e&&s.set(c,[i.get(d),l])}else{let l=o;for(let h=0;h<d.length;++h,++l){const u=d[h],f=r*l,p=f-r;let g=n[f];const m=Math.max(0,l-e-1),w=Math.min(r-1,l+e);for(let x=m;x<w;++x){const L=u!==t[x],C=n[p+x]+ +L,S=n[p+x+1]+1,y=n[f+x]+1,I=n[f+x+1]=Math.min(C,S,y);I<g&&(g=I)}if(g>e)continue t}K(i.get(d),t,e,s,n,l,r,c+d)}};class v{constructor(t=new Map,e=""){this._size=void 0,this._tree=t,this._prefix=e}atPrefix(t){if(!t.startsWith(this._prefix))throw new Error("Mismatched prefix");const[e,s]=k(this._tree,t.slice(this._prefix.length));if(e===void 0){const[n,o]=N(s);for(const r of n.keys())if(r!==_&&r.startsWith(o)){const c=new Map;return c.set(r.slice(o.length),n.get(r)),new v(c,t)}}return new v(e,t)}clear(){this._size=void 0,this._tree.clear()}delete(t){return this._size=void 0,lt(this._tree,t)}entries(){return new V(this,at)}forEach(t){for(const[e,s]of this)t(e,s,this)}fuzzyGet(t,e){return dt(this._tree,t,e)}get(t){const e=D(this._tree,t);return e!==void 0?e.get(_):void 0}has(t){const e=D(this._tree,t);return e!==void 0&&e.has(_)}keys(){return new V(this,Y)}set(t,e){if(typeof t!="string")throw new Error("key must be a string");return this._size=void 0,T(this._tree,t).set(_,e),this}get size(){if(this._size)return this._size;this._size=0;const t=this.entries();for(;!t.next().done;)this._size+=1;return this._size}update(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;const s=T(this._tree,t);return s.set(_,e(s.get(_))),this}fetch(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;const s=T(this._tree,t);let n=s.get(_);return n===void 0&&s.set(_,n=e()),n}values(){return new V(this,H)}[Symbol.iterator](){return this.entries()}static from(t){const e=new v;for(const[s,n]of t)e.set(s,n);return e}static fromObject(t){return v.from(Object.entries(t))}}const k=(i,t,e=[])=>{if(t.length===0||i==null)return[i,e];for(const s of i.keys())if(s!==_&&t.startsWith(s))return e.push([i,s]),k(i.get(s),t.slice(s.length),e);return e.push([i,t]),k(void 0,"",e)},D=(i,t)=>{if(t.length===0||i==null)return i;for(const e of i.keys())if(e!==_&&t.startsWith(e))return D(i.get(e),t.slice(e.length))},T=(i,t)=>{const e=t.length;t:for(let s=0;i&&s<e;){for(const o of i.keys())if(o!==_&&t[s]===o[0]){const r=Math.min(e-s,o.length);let c=1;for(;c<r&&t[s+c]===o[c];)++c;const a=i.get(o);if(c===o.length)i=a;else{const d=new Map;d.set(o.slice(c),a),i.set(t.slice(s,s+c),d),i.delete(o),i=d}s+=c;continue t}const n=new Map;return i.set(t.slice(s),n),n}return i},lt=(i,t)=>{const[e,s]=k(i,t);if(e!==void 0){if(e.delete(_),e.size===0)G(s);else if(e.size===1){const[n,o]=e.entries().next().value;Z(s,n,o)}}},G=i=>{if(i.length===0)return;const[t,e]=N(i);if(t.delete(e),t.size===0)G(i.slice(0,-1));else if(t.size===1){const[s,n]=t.entries().next().value;s!==_&&Z(i.slice(0,-1),s,n)}},Z=(i,t,e)=>{if(i.length===0)return;const[s,n]=N(i);s.set(n+t,e),s.delete(n)},N=i=>i[i.length-1],U="or",X="and",ut="and_not";class z{constructor(t){if((t==null?void 0:t.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');const e=t.autoVacuum==null||t.autoVacuum===!0?A:t.autoVacuum;this._options={...E,...t,autoVacuum:e,searchOptions:{...P,...t.searchOptions||{}},autoSuggestOptions:{...pt,...t.autoSuggestOptions||{}}},this._index=new v,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=j,this.addFields(this._options.fields)}add(t){const{extractField:e,stringifyField:s,tokenize:n,processTerm:o,fields:r,idField:c}=this._options,a=e(t,c);if(a==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);if(this._idToShortId.has(a))throw new Error(`MiniSearch: duplicate ID ${a}`);const d=this.addDocumentId(a);this.saveStoredFields(d,t);for(const l of r){const h=e(t,l);if(h==null)continue;const u=n(s(h,l),l),f=this._fieldIds[l],p=new Set(u).size;this.addFieldLength(d,f,this._documentCount-1,p);for(const g of u){const m=o(g,l);if(Array.isArray(m))for(const w of m)this.addTerm(f,d,w);else m&&this.addTerm(f,d,m)}}}addAll(t){for(const e of t)this.add(e)}addAllAsync(t,e={}){const{chunkSize:s=10}=e,n={chunk:[],promise:Promise.resolve()},{chunk:o,promise:r}=t.reduce(({chunk:c,promise:a},d,l)=>(c.push(d),(l+1)%s===0?{chunk:[],promise:a.then(()=>new Promise(h=>setTimeout(h,0))).then(()=>this.addAll(c))}:{chunk:c,promise:a}),n);return r.then(()=>this.addAll(o))}remove(t){const{tokenize:e,processTerm:s,extractField:n,stringifyField:o,fields:r,idField:c}=this._options,a=n(t,c);if(a==null)throw new Error(`MiniSearch: document does not have ID field "${c}"`);const d=this._idToShortId.get(a);if(d==null)throw new Error(`MiniSearch: cannot remove document with ID ${a}: it is not in the index`);for(const l of r){const h=n(t,l);if(h==null)continue;const u=e(o(h,l),l),f=this._fieldIds[l],p=new Set(u).size;this.removeFieldLength(d,f,this._documentCount,p);for(const g of u){const m=s(g,l);if(Array.isArray(m))for(const w of m)this.removeTerm(f,d,w);else m&&this.removeTerm(f,d,m)}}this._storedFields.delete(d),this._documentIds.delete(d),this._idToShortId.delete(a),this._fieldLength.delete(d),this._documentCount-=1}removeAll(t){if(t)for(const e of t)this.remove(e);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new v,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(t){const e=this._idToShortId.get(t);if(e==null)throw new Error(`MiniSearch: cannot discard document with ID ${t}: it is not in the index`);this._idToShortId.delete(t),this._documentIds.delete(e),this._storedFields.delete(e),(this._fieldLength.get(e)||[]).forEach((s,n)=>{this.removeFieldLength(e,n,this._documentCount,s)}),this._fieldLength.delete(e),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;const{minDirtFactor:t,minDirtCount:e,batchSize:s,batchWait:n}=this._options.autoVacuum;this.conditionalVacuum({batchSize:s,batchWait:n},{minDirtCount:e,minDirtFactor:t})}discardAll(t){const e=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const s of t)this.discard(s)}finally{this._options.autoVacuum=e}this.maybeAutoVacuum()}replace(t){const{idField:e,extractField:s}=this._options,n=s(t,e);this.discard(n),this.add(t)}vacuum(t={}){return this.conditionalVacuum(t)}conditionalVacuum(t,e){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&e,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{const s=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=j,this.performVacuuming(t,s)}),this._enqueuedVacuum)):this.vacuumConditionsMet(e)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(t),this._currentVacuum)}async performVacuuming(t,e){const s=this._dirtCount;if(this.vacuumConditionsMet(e)){const n=t.batchSize||$.batchSize,o=t.batchWait||$.batchWait;let r=1;for(const[c,a]of this._index){for(const[d,l]of a)for(const[h]of l)this._documentIds.has(h)||(l.size<=1?a.delete(d):l.delete(h));this._index.get(c).size===0&&this._index.delete(c),r%n===0&&await new Promise(d=>setTimeout(d,o)),r+=1}this._dirtCount-=s}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(t){if(t==null)return!0;let{minDirtCount:e,minDirtFactor:s}=t;return e=e||A.minDirtCount,s=s||A.minDirtFactor,this.dirtCount>=e&&this.dirtFactor>=s}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(t){return this._idToShortId.has(t)}getStoredFields(t){const e=this._idToShortId.get(t);if(e!=null)return this._storedFields.get(e)}search(t,e={}){const{searchOptions:s}=this._options,n={...s,...e},o=this.executeQuery(t,e),r=[];for(const[c,{score:a,terms:d,match:l}]of o){const h=d.length||1,u={id:this._documentIds.get(c),score:a*h,terms:Object.keys(l),queryTerms:d,match:l};Object.assign(u,this._storedFields.get(c)),(n.filter==null||n.filter(u))&&r.push(u)}return t===z.wildcard&&n.boostDocument==null||r.sort(J),r}autoSuggest(t,e={}){e={...this._options.autoSuggestOptions,...e};const s=new Map;for(const{score:o,terms:r}of this.search(t,e)){const c=r.join(" "),a=s.get(c);a!=null?(a.score+=o,a.count+=1):s.set(c,{score:o,terms:r,count:1})}const n=[];for(const[o,{score:r,terms:c,count:a}]of s)n.push({suggestion:o,terms:c,score:r/a});return n.sort(J),n}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(t,e){if(e==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(t),e)}static async loadJSONAsync(t,e){if(e==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(t),e)}static getDefault(t){if(E.hasOwnProperty(t))return O(E,t);throw new Error(`MiniSearch: unknown option "${t}"`)}static loadJS(t,e){const{index:s,documentIds:n,fieldLength:o,storedFields:r,serializationVersion:c}=t,a=this.instantiateMiniSearch(t,e);a._documentIds=F(n),a._fieldLength=F(o),a._storedFields=F(r);for(const[d,l]of a._documentIds)a._idToShortId.set(l,d);for(const[d,l]of s){const h=new Map;for(const u of Object.keys(l)){let f=l[u];c===1&&(f=f.ds),h.set(parseInt(u,10),F(f))}a._index.set(d,h)}return a}static async loadJSAsync(t,e){const{index:s,documentIds:n,fieldLength:o,storedFields:r,serializationVersion:c}=t,a=this.instantiateMiniSearch(t,e);a._documentIds=await M(n),a._fieldLength=await M(o),a._storedFields=await M(r);for(const[l,h]of a._documentIds)a._idToShortId.set(h,l);let d=0;for(const[l,h]of s){const u=new Map;for(const f of Object.keys(h)){let p=h[f];c===1&&(p=p.ds),u.set(parseInt(f,10),await M(p))}++d%1e3===0&&await q(0),a._index.set(l,u)}return a}static instantiateMiniSearch(t,e){const{documentCount:s,nextId:n,fieldIds:o,averageFieldLength:r,dirtCount:c,serializationVersion:a}=t;if(a!==1&&a!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const d=new z(e);return d._documentCount=s,d._nextId=n,d._idToShortId=new Map,d._fieldIds=o,d._avgFieldLength=r,d._dirtCount=c||0,d._index=new v,d}executeQuery(t,e={}){if(t===z.wildcard)return this.executeWildcardQuery(e);if(typeof t!="string"){const u={...e,...t,queries:void 0},f=t.queries.map(p=>this.executeQuery(p,u));return this.combineResults(f,u.combineWith)}const{tokenize:s,processTerm:n,searchOptions:o}=this._options,r={tokenize:s,processTerm:n,...o,...e},{tokenize:c,processTerm:a}=r,h=c(t).flatMap(u=>a(u)).filter(u=>!!u).map(gt(r)).map(u=>this.executeQuerySpec(u,r));return this.combineResults(h,r.combineWith)}executeQuerySpec(t,e){const s={...this._options.searchOptions,...e},n=(s.fields||this._options.fields).reduce((g,m)=>({...g,[m]:O(s.boost,m)||1}),{}),{boostDocument:o,weights:r,maxFuzzy:c,bm25:a}=s,{fuzzy:d,prefix:l}={...P.weights,...r},h=this._index.get(t.term),u=this.termResults(t.term,t.term,1,t.termBoost,h,n,o,a);let f,p;if(t.prefix&&(f=this._index.atPrefix(t.term)),t.fuzzy){const g=t.fuzzy===!0?.2:t.fuzzy,m=g<1?Math.min(c,Math.round(t.term.length*g)):g;m&&(p=this._index.fuzzyGet(t.term,m))}if(f)for(const[g,m]of f){const w=g.length-t.term.length;if(!w)continue;p==null||p.delete(g);const x=l*g.length/(g.length+.3*w);this.termResults(t.term,g,x,t.termBoost,m,n,o,a,u)}if(p)for(const g of p.keys()){const[m,w]=p.get(g);if(!w)continue;const x=d*g.length/(g.length+w);this.termResults(t.term,g,x,t.termBoost,m,n,o,a,u)}return u}executeWildcardQuery(t){const e=new Map,s={...this._options.searchOptions,...t};for(const[n,o]of this._documentIds){const r=s.boostDocument?s.boostDocument(o,"",this._storedFields.get(n)):1;e.set(n,{score:r,terms:[],match:{}})}return e}combineResults(t,e=U){if(t.length===0)return new Map;const s=e.toLowerCase(),n=ht[s];if(!n)throw new Error(`Invalid combination operator: ${e}`);return t.reduce(n)||new Map}toJSON(){const t=[];for(const[e,s]of this._index){const n={};for(const[o,r]of s)n[o]=Object.fromEntries(r);t.push([e,n])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:t,serializationVersion:2}}termResults(t,e,s,n,o,r,c,a,d=new Map){if(o==null)return d;for(const l of Object.keys(r)){const h=r[l],u=this._fieldIds[l],f=o.get(u);if(f==null)continue;let p=f.size;const g=this._avgFieldLength[u];for(const m of f.keys()){if(!this._documentIds.has(m)){this.removeTerm(u,m,e),p-=1;continue}const w=c?c(this._documentIds.get(m),e,this._storedFields.get(m)):1;if(!w)continue;const x=f.get(m),L=this._fieldLength.get(m)[u],C=mt(x,p,this._documentCount,L,g,a),S=s*n*h*w*C,y=d.get(m);if(y){y.score+=S,_t(y.terms,t);const I=O(y.match,e);I?I.push(l):y.match[e]=[l]}else d.set(m,{score:S,terms:[t],match:{[e]:[l]}})}}return d}addTerm(t,e,s){const n=this._index.fetch(s,B);let o=n.get(t);if(o==null)o=new Map,o.set(e,1),n.set(t,o);else{const r=o.get(e);o.set(e,(r||0)+1)}}removeTerm(t,e,s){if(!this._index.has(s)){this.warnDocumentChanged(e,t,s);return}const n=this._index.fetch(s,B),o=n.get(t);o==null||o.get(e)==null?this.warnDocumentChanged(e,t,s):o.get(e)<=1?o.size<=1?n.delete(t):o.delete(e):o.set(e,o.get(e)-1),this._index.get(s).size===0&&this._index.delete(s)}warnDocumentChanged(t,e,s){for(const n of Object.keys(this._fieldIds))if(this._fieldIds[n]===e){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(t)} has changed before removal: term "${s}" was not present in field "${n}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(t){const e=this._nextId;return this._idToShortId.set(t,e),this._documentIds.set(e,t),this._documentCount+=1,this._nextId+=1,e}addFields(t){for(let e=0;e<t.length;e++)this._fieldIds[t[e]]=e}addFieldLength(t,e,s,n){let o=this._fieldLength.get(t);o==null&&this._fieldLength.set(t,o=[]),o[e]=n;const c=(this._avgFieldLength[e]||0)*s+n;this._avgFieldLength[e]=c/(s+1)}removeFieldLength(t,e,s,n){if(s===1){this._avgFieldLength[e]=0;return}const o=this._avgFieldLength[e]*s-n;this._avgFieldLength[e]=o/(s-1)}saveStoredFields(t,e){const{storeFields:s,extractField:n}=this._options;if(s==null||s.length===0)return;let o=this._storedFields.get(t);o==null&&this._storedFields.set(t,o={});for(const r of s){const c=n(e,r);c!==void 0&&(o[r]=c)}}}z.wildcard=Symbol("*");const O=(i,t)=>Object.prototype.hasOwnProperty.call(i,t)?i[t]:void 0,ht={[U]:(i,t)=>{for(const e of t.keys()){const s=i.get(e);if(s==null)i.set(e,t.get(e));else{const{score:n,terms:o,match:r}=t.get(e);s.score=s.score+n,s.match=Object.assign(s.match,r),W(s.terms,o)}}return i},[X]:(i,t)=>{const e=new Map;for(const s of t.keys()){const n=i.get(s);if(n==null)continue;const{score:o,terms:r,match:c}=t.get(s);W(n.terms,r),e.set(s,{score:n.score+o,terms:n.terms,match:Object.assign(n.match,c)})}return e},[ut]:(i,t)=>{for(const e of t.keys())i.delete(e);return i}},ft={k:1.2,b:.7,d:.5},mt=(i,t,e,s,n,o)=>{const{k:r,b:c,d:a}=o;return Math.log(1+(e-t+.5)/(t+.5))*(a+i*(r+1)/(i+r*(1-c+c*s/n)))},gt=i=>(t,e,s)=>{const n=typeof i.fuzzy=="function"?i.fuzzy(t,e,s):i.fuzzy||!1,o=typeof i.prefix=="function"?i.prefix(t,e,s):i.prefix===!0,r=typeof i.boostTerm=="function"?i.boostTerm(t,e,s):1;return{term:t,fuzzy:n,prefix:o,termBoost:r}},E={idField:"id",extractField:(i,t)=>i[t],stringifyField:(i,t)=>i.toString(),tokenize:i=>i.split(wt),processTerm:i=>i.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(i,t)=>{typeof(console==null?void 0:console[i])=="function"&&console[i](t)},autoVacuum:!0},P={combineWith:U,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:ft},pt={combineWith:X,prefix:(i,t,e)=>t===e.length-1},$={batchSize:1e3,batchWait:10},j={minDirtFactor:.1,minDirtCount:20},A={...$,...j},_t=(i,t)=>{i.includes(t)||i.push(t)},W=(i,t)=>{for(const e of t)i.includes(e)||i.push(e)},J=({score:i},{score:t})=>t-i,B=()=>new Map,F=i=>{const t=new Map;for(const e of Object.keys(i))t.set(parseInt(e,10),i[e]);return t},M=async i=>{const t=new Map;let e=0;for(const s of Object.keys(i))t.set(parseInt(s,10),i[s]),++e%1e3===0&&await q(0);return t},q=i=>new Promise(t=>setTimeout(t,i)),wt=/[\n\r\p{Z}\p{P}]+/u;let tt=new z({fields:["title","alternativeTitles"],storeFields:["id","title","posterUrl","thumbnailUrl","type","releaseYear","rating","alternativeTitles"],searchOptions:{boost:{title:2},fuzzy:.2,prefix:!0}}),et=[],R=!1;async function xt(){if(!R)try{console.log("Starting to load search index...");const i=await it(ot(rt,`artifacts/${ct}/public/data/shows`)),t=[];i.forEach(e=>{const s=e.data(),n=s.posterUrl||s.thumbnailUrl||"",o={id:e.id,title:s.title||"Unknown Title",posterUrl:n,thumbnailUrl:n,type:s.type||"TV",releaseYear:s.releaseDate?new Date(s.releaseDate).getFullYear():"-",rating:s.rating||0,alternativeTitles:(s.alternativeTitles||[]).concat(s.tags||[]).join(" ")};t.push(o)}),tt.addAll(t),et=t,R=!0,console.log(`Search Index Loaded: ${t.length} items.`)}catch(i){console.error("Critical Error loading search index:",i)}}function vt(i){if(!i||!R)return[];const t=i.toLowerCase().trim(),e=tt.search(i),s=et.filter(o=>{const r=o.title.toLowerCase().includes(t),c=o.alternativeTitles.toLowerCase().includes(t);return r||c}),n=new Map;return e.forEach(o=>n.set(o.id,o)),s.forEach(o=>{n.has(o.id)||n.set(o.id,o)}),Array.from(n.values())}xt();function St(){Q("search-input","search-dropdown"),Q("mobile-search-input","mobile-search-dropdown")}function st(){return window.location.pathname.includes("/pages/")?"":"pages/"}function Q(i,t){const e=document.getElementById(i),s=document.getElementById(t);if(!e||!s)return;const n=nt(o=>{if(!o||o.length<2){s.classList.add("hidden");return}const r=vt(o).slice(0,6);yt(r,s,o)},200);e.addEventListener("input",o=>n(o.target.value.trim())),e.addEventListener("focus",()=>{e.value.trim().length>=2&&s.classList.remove("hidden")}),document.addEventListener("click",o=>{!e.contains(o.target)&&!s.contains(o.target)&&s.classList.add("hidden")}),e.addEventListener("keypress",o=>{if(o.key==="Enter"){const r=o.target.value.trim();r&&(window.location.href=`${st()}grid.html?search=${encodeURIComponent(r)}`)}})}function yt(i,t,e){t.className="absolute left-0 right-0 mt-2 w-full bg-[#1a1c22] border border-gray-700 rounded-xl shadow-2xl z-50 overflow-hidden hidden";const s=st();if(i.length===0)t.innerHTML=`
            <div class="p-4 text-center">
                <p class="text-sm text-gray-400">ไม่พบผลลัพธ์สำหรับ "<span class="text-white">${e}</span>"</p>
            </div>`;else{const n=i.map(r=>{const c=r.posterUrl&&r.posterUrl.trim()!==""?r.posterUrl:"https://placehold.co/40x60/333/999?text=No+Img";return`
            <a href="${s}player.html?id=${r.id}" 
               class="flex items-center gap-3 p-3 border-b border-gray-800 hover:bg-[#252830] transition-colors group">
                
                <div class="relative flex-shrink-0 w-10 h-14 overflow-hidden rounded bg-gray-800 shadow-lg">
                    <img src="${c}" 
                         alt="${r.title}"
                         class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                         loading="lazy"
                         onerror="this.src='https://placehold.co/40x60/333/999?text=Error'">
                </div>
                
                <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium text-gray-200 truncate group-hover:text-green-400 transition-colors">
                        ${bt(r.title,e)}
                    </h4>
                    <div class="flex items-center gap-2 mt-0.5 text-xs text-gray-500">
                        <span class="bg-gray-800 px-1.5 py-0.5 rounded text-gray-400 border border-gray-700/50">${r.type||"TV"}</span>
                        <span>${r.releaseYear||"-"}</span>
                        ${r.rating?`<span class="flex items-center text-yellow-500"><i class="ri-star-fill mr-0.5"></i>${parseFloat(r.rating).toFixed(1)}</span>`:""}
                    </div>
                </div>

                <i class="ri-arrow-right-s-line text-gray-600 group-hover:text-white transition-colors"></i>
            </a>
            `}).join(""),o=`
            <a href="${s}grid.html?search=${encodeURIComponent(e)}" 
               class="block py-3 text-center text-xs font-bold text-green-400 bg-[#16181d] hover:bg-gray-800 transition-colors hover:text-green-300 uppercase tracking-wider">
                ดูผลการค้นหาทั้งหมด
            </a>
        `;t.innerHTML=n+o}t.classList.remove("hidden")}function bt(i,t){if(!t)return i;try{const e=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return i.replace(e,'<span class="text-green-400 font-bold">$1</span>')}catch{return i}}export{vt as a,xt as l,St as s};
